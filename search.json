[{"path":"http://marinebon.org/obisindicators/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2022 obisindicators authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"http://marinebon.org/obisindicators/articles/obisindicators.html","id":"use-data","dir":"Articles","previous_headings":"","what":"use data","title":"obisindicators","text":"","code":"occ <- occ_1M"},{"path":"http://marinebon.org/obisindicators/articles/obisindicators.html","id":"create-a-discrete-global-grid","dir":"Articles","previous_headings":"","what":"Create a discrete global grid","title":"obisindicators","text":"Create ISEA discrete global grid resolution 9 using dggridR package: ’s overview possible resolutions: assign cell numbers occurrence data:","code":"library(dggridR) # remotes::install_github(\"r-barnes/dggridR\")  dggs <- dgconstruct(projection = \"ISEA\", topology = \"HEXAGON\", res = 9) inf <- dginfo(dggs) #>    res            cells                area_km      spacing_km          cls_km #> 1    0               12 51006562.1724088639021 7053.6524314108 8199.5003701020 #> 2    1               32 17002187.3908029571176 4072.4281300451 4678.9698717297 #> 3    2               92  5667395.7969343187287 2351.2174771369 2691.2520709129 #> 4    3              272  1889131.9323114394210 1357.4760433484 1551.8675487723 #> 5    4              812   629710.6441038132180  783.7391590456  895.6018416484 #> 6    5             2432   209903.5480346043769  452.4920144495  517.0049969031 #> 7    6             7292    69967.8493448681256  261.2463863485  298.4793231872 #> 8    7            21872    23322.6164482893764  150.8306714832  172.3244908961 #> 9    8            65612     7774.2054827631255   87.0821287828   99.4910857272 #> 10   9           196832     2591.4018275877083   50.2768904944   57.4411078487 #> 11  10           590492      863.8006091959028   29.0273762609   33.1636203580 #> 12  11          1771472      287.9335363986343   16.7589634981   19.1470215381 #> 13  12          5314412       95.9778454662114    9.6757920870   11.0545373459 #> 14  13         15943232       31.9926151554038    5.5863211660    6.3823399790 #> 15  14         47829692       10.6642050518013    3.2252640290    3.6848456792 #> 16  15        143489072        3.5547350172671    1.8621070553    2.1274466399 #> 17  16        430467212        1.1849116724224    1.0750880097    1.2282818893 #> 18  17       1291401632        0.3949705574741    0.6207023518    0.7091488792 #> 19  18       3874204892        0.1316568524914    0.3583626699    0.4094272963 #> 20  19      11622614672        0.0438856174971    0.2069007839    0.2363829597 #> 21  20      34867844012        0.0146285391657    0.1194542233    0.1364757654 #> 22  21     104603532032        0.0048761797219    0.0689669280    0.0787943199 #> 23  22     313810596092        0.0016253932406    0.0398180744    0.0454919218 #> 24  23     941431788272        0.0005417977469    0.0229889760    0.0262647733 #> 25  24    2824295364812        0.0001805992490    0.0132726915    0.0151639739 #> 26  25    8472886094432        0.0000601997497    0.0076629920    0.0087549244 #> 27  26   25418658283292        0.0000200665832    0.0044242305    0.0050546580 #> 28  27   76255974849872        0.0000066888611    0.0025543307    0.0029183081 #> 29  28  228767924549612        0.0000022296204    0.0014747435    0.0016848860 #> 30  29  686303773648832        0.0000007432068    0.0008514436    0.0009727694 #> 31  30 2058911320946492        0.0000002477356    0.0004915812    0.0005616287 system.time({ occ$cell <- dgGEO_to_SEQNUM(dggs, occ$decimalLongitude, occ$decimalLatitude) # dgtransform deprecated }) # elapsed: 8.693 #>    user  system elapsed  #>  15.413   0.004  15.418"},{"path":"http://marinebon.org/obisindicators/articles/obisindicators.html","id":"calculate-metrics","dir":"Articles","previous_headings":"","what":"Calculate metrics","title":"obisindicators","text":"following function calculates number records, species richness, Simpson index, Shannon index, Hurlbert index (n = 50), Hill numbers cell. Perform calculation species level data: Add cell geometries metrics table: Let’s check results creating Shannon index map:","code":"# library(gsl) #  # calc_es50() <- function(df, esn = 50) { #   t1 <- df %>% #     group_by(cell, species) %>% #     summarize(ni = sum(records)) #   t2 <- t1 %>% #     group_by(cell) %>% #     mutate(n = sum(ni)) #   t3 <- t2 %>% #     group_by(cell, species) %>% #     mutate( #       hi = -(ni/n*log(ni/n)), #       si = (ni/n)^2, #       qi = ni/n, #       esi = case_when( #         n-ni >= esn ~ 1-exp(lngamma(n-ni+1)+lngamma(n-esn+1)-lngamma(n-ni-esn+1)-lngamma(n+1)), #         n >= esn ~ 1 #       ) #     ) #   t4 <- t3 %>% #     group_by(cell) %>% #     summarize( #       n = sum(ni), #       sp = n(), #       shannon = sum(hi), #       simpson = sum(si), #       maxp = max(qi), #       es = sum(esi) #     ) #   result <- t4 %>% #     mutate( #       hill_1 = exp(shannon), #       hill_2 = 1/simpson, #       hill_inf = 1/maxp #     ) #   return(result) # } system.time({ metrics <- occ %>%   #filter(!is.na(species)) %>%   calc_es50() }) # started 11:43 am  metrics library(sf)  grid <- dgearthgrid(dggs, frame = FALSE, wrapcells = FALSE) grid_sf <- grid %>%   st_as_sf() %>%   st_wrap_dateline(options = c(\"WRAPDATELINE=YES\", \"DATELINEOFFSET=230\")) grid_sf$cell <- names(grid)  metrics <- merge(metrics, grid_sf, by.x = \"cell\", by.y = \"cell\") %>%     filter(st_intersects(geometry, st_as_sfc(\"SRID=4326;POLYGON((-180 85,180 85,180 -85,-180 -85,-180 85))\"), sparse = FALSE)) library(rnaturalearth) library(rnaturalearthdata) library(viridis) library(ggplot2)  world <- ne_countries(scale = \"medium\", returnclass = \"sf\")  ggplot() +     geom_sf(data = metrics, aes_string(fill = \"shannon\", geometry = \"geometry\"), lwd = 0) +     scale_fill_viridis(option = \"inferno\", na.value = \"white\", name = \"Shannon index\") +     geom_sf(data = world, fill = \"#dddddd\", color = NA) +     theme(panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), panel.background = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), axis.ticks = element_blank(), axis.title.x = element_blank(), axis.title.y = element_blank()) + xlab(\"\") + ylab(\"\") +     coord_sf()"},{"path":[]},{"path":"http://marinebon.org/obisindicators/articles/obisindicators.html","id":"shapefile","dir":"Articles","previous_headings":"Output","what":"Shapefile","title":"obisindicators","text":"Write metrics table shapefile:","code":"files <- dir(\"shapefile\", full.names = TRUE) file.remove(files) st_write(metrics, \"shapefile/indicators.shp\", layer = \"indicators\") files <- dir(\"shapefile\", full.names = TRUE) zip(zipfile = \"shapefile/metrics.zip\", files = files) file.remove(files)"},{"path":"http://marinebon.org/obisindicators/articles/obisindicators.html","id":"map-image","dir":"Articles","previous_headings":"Output","what":"Map image","title":"obisindicators","text":"create high resolution PNG map image.","code":"metrics <- st_sf(metrics, sf_column_name = \"geometry\") st_crs(metrics) <- 4326  ggplot() +   geom_sf(data = metrics, aes_string(fill = \"n\", color = \"n\", geometry = \"geometry\"), lwd = 0.04) +   scale_color_viridis(option = \"inferno\", na.value = \"white\", name = \"Number of records\", trans = \"log10\") +   scale_fill_viridis(option = \"inferno\", na.value = \"white\", name = \"Number of records\", trans = \"log10\") +   geom_sf(data = world, fill = \"#dddddd\", color = \"#666666\", lwd = 0.1) +   theme(     panel.grid.major.x = element_blank(),     panel.grid.major.y = element_blank(),     panel.grid.minor.x = element_blank(),     panel.grid.minor.y = element_blank(),      panel.background = element_blank(),     axis.text.x = element_blank(),     axis.text.y = element_blank(),     axis.ticks = element_blank(),     axis.title.x = element_blank(),     axis.title.y = element_blank(),     legend.position = \"bottom\"   ) +   xlab(\"\") + ylab(\"\") +   coord_sf(crs = \"+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs\" )  ggsave(\"map/map.png\", width = 12, height = 6, dpi = 600)"},{"path":"http://marinebon.org/obisindicators/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Ben Ben. Author, maintainer. Pieter Provoost. Author.","code":""},{"path":"http://marinebon.org/obisindicators/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Ben B, Provoost P (2022). obisindicators: Develop marine biodiversity indicators OBIS data. R package version 0.0.1, http://marinebon.org/obisindicators/.","code":"@Manual{,   title = {obisindicators: Develop marine biodiversity indicators from OBIS data},   author = {Ben Ben and Pieter Provoost},   year = {2022},   note = {R package version 0.0.1},   url = {http://marinebon.org/obisindicators/}, }"},{"path":"http://marinebon.org/obisindicators/index.html","id":"obisindicators","dir":"","previous_headings":"","what":"Develop marine biodiversity indicators from OBIS data","title":"Develop marine biodiversity indicators from OBIS data","text":"R package generating indicators OBIS","code":""},{"path":"http://marinebon.org/obisindicators/index.html","id":"install","dir":"","previous_headings":"","what":"Install","title":"Develop marine biodiversity indicators from OBIS data","text":"","code":"remotes::install_github(\"mbon/obisindicators\")"},{"path":"http://marinebon.org/obisindicators/index.html","id":"use","dir":"","previous_headings":"","what":"Use","title":"Develop marine biodiversity indicators from OBIS data","text":"","code":"library(obisindicators)"},{"path":"http://marinebon.org/obisindicators/reference/calc_es50.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate ES50 (Hurlbert index) — calc_es50","title":"Calculate ES50 (Hurlbert index) — calc_es50","text":"Calculate expected number marine species random sample 50 individuals (records)","code":""},{"path":"http://marinebon.org/obisindicators/reference/calc_es50.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate ES50 (Hurlbert index) — calc_es50","text":"","code":"calc_es50(df, esn = 50)"},{"path":"http://marinebon.org/obisindicators/reference/calc_es50.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate ES50 (Hurlbert index) — calc_es50","text":"df data frame esn expected number marine species","code":""},{"path":"http://marinebon.org/obisindicators/reference/calc_es50.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate ES50 (Hurlbert index) — calc_es50","text":"value","code":""},{"path":"http://marinebon.org/obisindicators/reference/calc_es50.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate ES50 (Hurlbert index) — calc_es50","text":"expected number marine species random sample 50 individuals (records) indicator marine biodiversity richness. ES50 defined OBIS sum(esi) species following per species calculation: `n - ni >= 50 (n total number records cell ni total number records ith-species) esi = 1 - exp(lngamma(n-ni+1) + lngamma(n-50+1) - lngamma(n-ni-50+1) - lngamma(n+1)) n >= 50 esi = 1 else esi = NULL Warning: ES50 assumes individuals randomly distributed, sample size sufficiently large, samples taxonomically similar, samples taken manner.","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_1M.html","id":null,"dir":"Reference","previous_headings":"","what":"OBIS occurrences, global sample of 1 million records — occ_1M","title":"OBIS occurrences, global sample of 1 million records — occ_1M","text":"Simple dataset species location example purposes 2022-04-04.","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_1M.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"OBIS occurrences, global sample of 1 million records — occ_1M","text":"","code":"occ_1M"},{"path":"http://marinebon.org/obisindicators/reference/occ_1M.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"OBIS occurrences, global sample of 1 million records — occ_1M","text":"data frame 1,000,000 rows 4 variables: decimalLongitude: unique x decimalLatitude: unique y species: unique species records: number records based unique values x, y, species","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_1M.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"OBIS occurrences, global sample of 1 million records — occ_1M","text":"https://obis.org/data/access","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_SAtlantic.html","id":null,"dir":"Reference","previous_headings":"","what":"OBIS occurrences, South Atlantic full regional sample — occ_SAtlantic","title":"OBIS occurrences, South Atlantic full regional sample — occ_SAtlantic","text":"Simple dataset species location example purposes 2022-04-04.","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_SAtlantic.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"OBIS occurrences, South Atlantic full regional sample — occ_SAtlantic","text":"","code":"occ_SAtlantic"},{"path":"http://marinebon.org/obisindicators/reference/occ_SAtlantic.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"OBIS occurrences, South Atlantic full regional sample — occ_SAtlantic","text":"data frame 1,014,006 rows 4 variables: decimalLongitude: unique x decimalLatitude: unique y species: unique species records: number records based unique values x, y, species","code":""},{"path":"http://marinebon.org/obisindicators/reference/occ_SAtlantic.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"OBIS occurrences, South Atlantic full regional sample — occ_SAtlantic","text":"https://obis.org/data/access","code":""},{"path":"http://marinebon.org/obisindicators/news/index.html","id":"obisindicators-001","dir":"Changelog","previous_headings":"","what":"obisindicators 0.0.1","title":"obisindicators 0.0.1","text":"Added NEWS.md file track changes package.","code":""}]
